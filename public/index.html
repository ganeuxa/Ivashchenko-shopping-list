<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>üõí –°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h1>
    </header>

    <div class="input-section">
      <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
      <div class="input-row">
        <input type="number" id="itemQty" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1" min="1" />
        <input type="number" id="itemPrice" placeholder="–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (‚ÇΩ)" step="0.01" min="0" />
      </div>
      <button class="btn" onclick="addItem()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </div>

    <ul class="items-list" id="list"></ul>

    <div class="checkout-section">
      <button class="btn checkout-btn" onclick="checkout()">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</button>
    </div>

    <footer>
      –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø–æ –¢–ò–ü ‚Ä¢ –≠–§–ë–û-07-24
    </footer>
  </div>

  <script>
    async function loadItems() {
      const res = await fetch('/api/items');
      const items = await res.json();
      const list = document.getElementById('list');
      list.innerHTML = '';
      items.forEach(item => {
        const li = document.createElement('li');
        li.className = `item ${item.purchased ? 'purchased' : ''}`;
        li.innerHTML = `
          <div class="item-info">
            ${item.name} √ó ${item.quantity}
            <span class="item-price">${(item.price * item.quantity).toFixed(2)} ‚ÇΩ</span>
          </div>
          <div class="item-actions">
            <button class="btn ${item.purchased ? 'btn-secondary' : 'btn-success'}" 
                    onclick="toggle(${item.id})">
              ${item.purchased ? '–í–µ—Ä–Ω—É—Ç—å' : '–ö—É–ø–ª–µ–Ω–æ'}
            </button>
            <button class="btn btn-secondary" onclick="remove(${item.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    async function addItem() {
      const name = document.getElementById('itemName').value.trim();
      const qty = document.getElementById('itemQty').value;
      const price = document.getElementById('itemPrice').value;

      if (!name) return alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞.');
      if (price === '' || price < 0) return alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É.');

      await fetch('/api/items', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, quantity: Number(qty), price: Number(price) })
      });

      document.getElementById('itemName').value = '';
      document.getElementById('itemPrice').value = '';
      document.getElementById('itemQty').value = '1';
      loadItems();
    }

    async function toggle(id) {
      await fetch(`/api/items/${id}/toggle`, { method: 'PATCH' });
      loadItems();
    }

    async function remove(id) {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
        await fetch(`/api/items/${id}`, { method: 'DELETE' });
        loadItems();
      }
    }

    async function checkout() {
      const res = await fetch('/api/items/checkout', { method: 'POST' });
      const data = await res.json();
      alert(
        `üéâ –ü–æ–∫—É–ø–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!\n\n` +
        `–û–±—â–∞—è —Å—É–º–º–∞: ${data.total.toFixed(2)} ‚ÇΩ\n` +
        `–¢–æ–≤–∞—Ä–æ–≤ –≤ —á–µ–∫–µ: ${data.count}\n\n` +
        `üí¨ ${data.message}`
      );
    }

    loadItems();
  </script>
</body>
</html>